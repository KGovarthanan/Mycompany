pipeline {
    agent any
    environment {

APP_NAME = "gv_webapp"
RELEASE = "1.0.0"
DOCKER_USR = "govarthanank"
DOCKERHUB_CREDENTIALS = credentilas{'dockerhub'}
IMAGE_TAG = "${RELEASE}-${BUILD_NUMBER}"

    }

stages {
    stage("git checkout"){
    steps{
        checkout scm
    }
    }
    stage("BUILD"){
        steps{
            sh "mvn clean package"
        }
    }
stage("test")
{
    step{
       sh "mvn test"
       sh "ls /var/lib/jenkins/workspace/${JOB_NAME}/webpage/target/"
    }
}
stage("push image"){
    steps{
        echo "DOCKER_USR: ${DOCKER_USR}"
        echo "APP_NAME: ${APP_NAME}"
        echo "BUILD_NUMBER: ${BUILD_NUMBER}"
        sh "docker images"
        sh 'echo $DOCKERHUB_CREDENTIALS_PSM | sudo docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
        sh 'docker push ${DOCKER_USR}/${APP_NAME}:${IMAGE_TAG}'
        
    }
}
}
}
